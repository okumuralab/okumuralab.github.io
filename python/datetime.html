<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<title>日時</title>
<link rel="stylesheet" href="style.css">
<link rel="license" href="http://creativecommons.org/licenses/by/4.0/">
</head>
<body>

<nav id="breadcrumbs">
<a href="/~okumura/">ホーム</a> &gt;
<a href="./">Python</a> &gt;
</nav>

<h1>日時</h1>

<p>時間計測には <a href="https://docs.python.org/ja/3/library/timeit.html">timeit</a> モジュールまたは IPython の <code>%timeit</code> 機能が便利：</p>

<pre>
<code>In [ ]: %timeit x = 0; x = x + 1
29.7 ns ± 0.049 ns per loop (mean ± std. dev. of 7 runs, 10000000 loops each)

In [ ]: %timeit x = 0; x += 1
31.9 ns ± 0.0136 ns per loop (mean ± std. dev. of 7 runs, 10000000 loops each)
</code></pre>

<p>（あれ，<code>x += 1</code> より <code>x = x + 1</code> の方が若干速いんだ。）</p>

<p>ちなみに <code>%%timeit</code> とすると複数行の計測ができる。終了は空行を二つほど打つ：</p>

<pre>
<code>In [ ]: %%timeit
   ...: x = 0
   ...: x += 1
   ...: 
   ...: 
31.8 ns ± 0.0191 ns per loop (mean ± std. dev. of 7 runs, 10000000 loops each)
</code></pre>

<p><code>%timeit</code> の代わりに <code>%time</code> とすれば1回の時間を計測できる。</p>

<p><code>time.time()</code> は現在時刻を1970年からの秒数で返す（<code>float</code> 型）：</p>

<pre>
<code>import time

t1 = time.time()
time.sleep(1)
t2 = time.time()
print(t2 - t1)
</code></pre>

<p>年月日時分秒で表した時刻：</p>

<pre>
<code>time.localtime() # 現在時刻
time.localtime(t1)  # 1970年からの秒数t1の時刻
time.strftime('%Y-%m-%d %H:%M:%S', time.localtime(t1)) # 'YYYY-MM-DD HH:MM:SS'
</code></pre>

<p><code>datetime.datetime</code> 型は，年月日時分秒，マイクロ秒，タイムゾーン情報を持つ構造体である：</p>

<pre>
<code>import datetime

datetime.datetime.now()  # datetime.datetime(年, 月, 日, 時, 分, 秒, μ秒)
datetime.datetime.now().strftime('%Y-%m-%d %H:%M:%S') # 'YYYY-MM-DD HH:MM:SS'
f'{datetime.datetime.now():%Y-%m-%d %H:%M:%S}' # 上と同じ

x = datetime.datetime.now()
# しばらく経って・・・
y = datetime.datetime.now()
y - x     # datetime.timedelta(seconds=秒, microseconds=μ秒)
</code></pre>

<p>例えば2019年5月1日で始まる32日分の配列：</p>

<pre>
<code>import numpy as np
import matplotlib.pyplot as plt

t = [datetime.datetime(2019,5,1) + datetime.timedelta(days=i) for i in range(32)]
x = np.cumsum(np.random.randn(32))
plt.plot(t, x)
</code></pre>

<p>これでは見にくいので，少し工夫：</p>

<pre>
<code>import matplotlib.dates as mdates

ax = plt.subplot(1,1,1)
locator = mdates.AutoDateLocator()
formatter = mdates.ConciseDateFormatter(locator)
ax.xaxis.set_major_locator(locator)
ax.xaxis.set_major_formatter(formatter)
ax.plot(t, x)
</code></pre>

<p>NumPy の <a href="https://www.numpy.org/devdocs/reference/arrays.datetime.html"><code>datetime64</code></a> は最も柔軟な日時型である。年（<code>Y</code>），月（<code>M</code>），週（<code>W</code>），日（<code>D</code>），時（<code>h</code>），分（<code>m</code>），秒（<code>s</code>），ミリ秒（<code>ms</code>）などの単位で64ビット整数で表したものである。日時の起点は1970年1月1日頭である。タイムゾーンは考えない。一番大きい単位 <code>Y</code> を使った <code>datetime64[Y]</code> 型は ±9.2×10<sup>18</sup> 年まで表せる（宇宙の年齢は 1.38×10<sup>10</sup> 年ほど）。</p>

<pre>
<code>import numpy as np

np.datetime64("2019")  # np.datetime64("2019", "Y") と同じ
np.datetime64("2019-05")  # np.datetime64("2019-05", "M") と同じ
np.datetime64("2019-05-01")  # np.datetime64("2019-05-01", "D") と同じ
np.datetime64("2019-05-01 12:34:56")  # np.datetime64("2019-05-01 12:34:56", "s") と同じ
</code></pre>

<p>日時の差は <code>timedelta64()</code> で表す：</p>

<pre>
<code>t = np.array([np.datetime64("2019-05-01") + np.timedelta64(i,"D") for i in range(32)])
</code></pre>

<p>これは次のようにも書ける：</p>

<pre>
<code>t = np.arange(np.datetime64("2019-05-01"), np.datetime64("2019-06-02"))
</code></pre>

<p>pandas の Timestamp は NumPy の <code>datetime64[ns]</code>（ナノ秒単位）に限定しているので，1677年から2262年くらいまでしか扱えない（<a href="read.html">データの読み書き</a>参照）。</p>

<pre>
<code>import pandas as pd

t = pd.to_datetime("2020-05-06")
t = pd.to_datetime("2020年5月6日", format='%Y年%m月%d日')  # 上と同じ
t                      #==> Timestamp('2020-05-06 00:00:00')
t.to_numpy()           #==> numpy.datetime64('2020-05-06T00:00:00.000000000')
t.to_pydatetime()      #==> datetime.datetime(2020, 5, 6, 0, 0)
t.timestamp()          #==> 1588723200.0  # seconds since Epoch
t.value                #==> 1588723200000000000  # ns since Epoch
t.strftime("%Y-%m-%d") #==> '2020-05-06'
t.year                 #==> 2020
t.month                #==> 5
t.day                  #==> 6
t.dayofweek            #==> 2  # 水曜日
</code></pre>

<p>format の形式については <a href="https://docs.python.org/3/library/datetime.html#strftime-and-strptime-format-codes">strftime() and strptime() Format Codes</a> 参照。</p>

<hr>

<p><a href="../" rel="author">奥村 晴彦</a></p>

<p>
<!-- hhmts start -->
Last modified: <time>2020-05-06 14:41:44</time>
<!-- hhmts end -->
</p>
</body>
</html>
