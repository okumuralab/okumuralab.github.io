<!DOCTYPE html>
<html lang="ja">
<head>
<link rel="canonical" href="https://okumuralab.org/~okumura/python/zerodiv.html">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ゼロ除算</title>
<link rel="stylesheet" href="style.css">
<link rel="license" href="https://creativecommons.org/licenses/by/4.0/">
</head>
<body>

<nav id="breadcrumbs">
<a href="../">ホーム</a> &gt;
<a href="./">Python</a> &gt;
</nav>

<h1>ゼロ除算</h1>

<p>ゼロで割るとどうなるかは言語によります。</p>

<p>R で <code>1 / 0</code> と打ち込むと <code>Inf</code>（Infinity = 無限大）と返ってきます。<code>0 / 0</code> は <code>NaN</code>（Not a Number = 非数）になります。いずれにしても、エラーで止まることはありません。</p>

<p>Ruby では <code>1 / 0</code> や <code>0 / 0</code> は ZeroDivisionError になって止まりますが <code>1.0 / 0.0</code> は <code>Infinity</code>、<code>0.0 / 0.0</code> は <code>NaN</code> になります。C言語でも同じです。</p>

<p>ところが Python では <code>0</code> で割っても <code>0.0</code> で割っても ZeroDivisionError になり、そこで実行が止まってしまいます。これでは不便です。もちろん</p>

<pre>
try:
    x = a / b
except ZeroDivisionError:
    if a == 0:
        x = float("nan")
    else:
        x = float("inf")
</pre>

<p>のようなことはできますが、面倒です。</p>

<p>NumPy の数値（array の要素など）であれば大丈夫です：</p>

<pre class="cell">
import numpy as np

a = np.array([1, 0, 0])
print(a[0] / a[1])
print(a[1] / a[2])
</pre>

<pre>
inf
nan
</pre>

<div class="note">
<p>配列の要素でない数の場合は <code>np.float64(0)</code> のようにします。<code>np.array(0)</code> でもかまいません。</p>
</div>

<p>ただし、RuntimeWarning（実行時の警告）が出ます。RuntimeWarning を出したくなければ、あらかじめ</p>

<pre>
np.seterr(divide="ignore", invalid="ignore")
</pre>

<p>と打ち込んでおきます（invalid とは 0/0 のこと）。元に戻すには</p>

<pre>
np.seterr(divide="warn", invalid="warn")
</pre>

<p>とします（詳しくは <code>np.seterr</code> のヘルプ参照）。</p>

<p>特定の割り算だけ warn しないようにするには</p>

<pre>
with np.errstate(divide="ignore", invalid="ignore"):
    x = a / b
</pre>

<p>のようにします。</p>

<hr>

<footer>
<p><a href="../" rel="author">奥村 晴彦</a></p>
<p>Last modified: <time>2022-12-15 16:40:21 JST</time></p>
</footer>
</body>
</html>
