<!DOCTYPE html>
<html lang="ja">
<head>
<link rel="canonical" href="https://okumuralab.org/~okumura/python/numba.html">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Numba</title>
<link rel="stylesheet" href="style.css">
<link rel="license" href="https://creativecommons.org/licenses/by/4.0/">
</head>
<body>

<nav id="breadcrumbs">
<a href="../">ホーム</a> &gt;
<a href="./">Python</a> &gt;
</nav>

<h1>Numba</h1>

<p><a href="https://numba.pydata.org">Numba</a>（ナンバ）はPythonのJIT（Just In Time）コンパイラです。簡単にいえば，Pythonの自前の関数を高速にする仕組みです。以下は M1 Mac mini 上の Python 3.10.5 で実行しました。</p>

<p>速さ比べのため，まずは100万個の乱数を用意します：</p>

<pre>
<code>import numpy as np

rng = np.random.default_rng()
a = rng.random(1000000)
</code></pre>

<p>これをPython標準の <code>sum()</code> 関数を使って合計するのに要する時間を計測します：</p>

<pre>
<code>%timeit sum(a)
</code></pre>

<p>結果：</p>

<pre>
<code>35.6 ms ± 46.3 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)
</code></pre>

<p>次は，自前の関数を作って，時間を計測します：</p>

<pre>
<code>def sum1(a):
    s = 0
    for x in a:
        s += x
    return s

%timeit sum1(a)
</code></pre>

<p>結果：</p>

<pre>
<code>43.4 ms ± 805 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)
</code></pre>

<p>次はNumbaを使ってみましょう。<code>pip install numba</code> などとしてインストールしてから，次を実行します：</p>

<pre>
<code>from numba import jit

@jit(nopython=True)
def sum2(a):
    s = 0
    for x in a:
        s += x
    return s

%timeit sum2(a)
</code></pre>

<p>結果：</p>

<pre>
<code>1.2 ms ± 50.4 µs per loop (mean ± std. dev. of 7 runs, 1 loop each)
</code></pre>

<p>約1ミリ秒です。数十倍速くなりました。最後にNumPyの <code>np.sum()</code> も試します：</p>

<pre>
<code>%timeit np.sum(a)
</code></pre>

<p>結果：</p>

<pre>
<code>187 µs ± 865 ns per loop (mean ± std. dev. of 7 runs, 10,000 loops each)
</code></pre>

<p>Numbaで高速化したものよりさらに高速です。</p>

<p>つまり，ループを含むようなPythonのコードはたいていNumbaで高速化できますが，同じ機能のNumPy関数があるなら，そちらを使いましょう。</p>

<hr>

<p><a href="../" rel="author">奥村 晴彦</a></p>

<p>
<!-- hhmts start -->
Last modified: <time>2022-06-19 20:46:14 JST</time>
<!-- hhmts end -->
</p>
</body>
</html>
