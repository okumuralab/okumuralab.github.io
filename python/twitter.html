<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<title>Twitter</title>
<link rel="stylesheet" href="style.css">
<link rel="license" href="http://creativecommons.org/licenses/by/4.0/">
</head>
<body>

<nav id="breadcrumbs">
<a href="/~okumura/">ホーム</a> &gt;
<a href="./">Python</a> &gt;
</nav>

<h1>Twitter</h1>

<p>Twitter を Python から使うライブラリは <a href="https://developer.twitter.com/en/docs/developer-utilities/twitter-libraries.html">Twitter libraries</a> の Python の項にいくつかリストされている。どれがいいかわからないが，とりあえず一番上の <a href="https://github.com/bear/python-twitter/">python-twitter</a> を試してみる。インストールは</p>

<pre>
pip3 install python-twitter
</pre>

<p>でできる。</p>

<p>まずは Twitter のアプリケーション登録をする。方法は <a href="https://python-twitter.readthedocs.io/en/latest/">python-twitter's documentation</a> にも書かれているし，日本語の解説もたくさんある（例えば <a href="https://cre8cre8.com/python/twitter-api.htm">Python3でTwitterAPIを使う方法をどのサイトよりも丁寧に解説する</a> の前半）。</p>

<p>登録をしたら，Consumer Key，Consumer Secret，Access Token，Access Token Secret がもらえる。これらを次のコードの <code>...</code> の部分にコピペする。</p>

<p>試してみよう：</p>

<pre>
import twitter

api = twitter.Api(consumer_key='...',
                  consumer_secret='...',
                  access_token_key='...',
                  access_token_secret='...',
                  tweet_mode='extended',
                  sleep_on_rate_limit=True)

api.VerifyCredentials() # 自分が正しく認識できているかチェック

home = api.GetHomeTimeline() # ホームタイムラインを取得（デフォルト20件）
</pre>

<p>これで <code>home</code> を表示すればだいたいの感じがわかる。このクラスの詳細は <code>??twitter.models.Status</code> と打ち込めば出てくる。この中の必要な項目を自分好みに出力すればよい。簡単な例を挙げておく：</p>

<pre>
for t in home:
    if (t.retweeted_status):
        t = t.retweeted_status
    for u in t.urls:
        t.full_text = t.full_text.replace(u.url, u.expanded_url)
    print(t.id, t.created_at, t.user.screen_name, t.full_text)
</pre>

<p>これを少しいじれば，自家製Twitterクライアントができる。普段はEmacsのtwittering-modeを使っているが，自動処理にはコマンドラインで使えるほうが便利だ。</p>

<p>書き込みはこんな感じ（通常はツイート本文だけでよい）：</p>

<pre>
api.PostUpdate("テスト",  # ツイート本文（これだけ必須）
               media="hoge.jpg",  # 添付画像ファイル
               in_reply_to_status_id=1140050903828819970, # リプライ先のツイートID
               auto_populate_reply_metadata=True, # リプライ先の @... を自動挿入
               attachment_url="https://twitter.com/.../status/...", # 引用リツイート
               latitude=34.7468, longitude=136.5248, # 位置情報
               display_coordinates=True) # 正確な位置情報にするか
</pre>

<p>引用リツイートは従来のようにツイート本文末尾にURLを書いてもいいが，<code>attachment_url="..."</code> で指定すると文字数カウントに入らない。リプライの先頭に付ける <code>@...</code> も，手で書く代わりに <code>auto_populate_reply_metadata=True</code> にすれば自動で入り，文字数カウントに入らない。</p>

<p><code>r = api.PostUpdate(...)</code> のように戻り値を取得すれば，例えば <code>r.id</code> でツイートのIDが調べられる。ツイートをつなげていくときに便利。</p>

<p>検索は<a href="https://python-twitter.readthedocs.io/en/latest/searching.html">ドキュメント</a>に生クエリの方法が書いてある。例：</p>

<pre>
results = api.GetSearch(
    raw_query="q=twitter%20&amp;result_type=recent&amp;since=2014-07-19&amp;count=100")
</pre>

<hr>

<p><a href="../" rel="author">奥村 晴彦</a></p>

<p>
<!-- hhmts start -->
Last modified: <time>2019-06-18 10:18:32</time>
<!-- hhmts end -->
</p>
</body>
</html>
