<!DOCTYPE html>
<html lang="ja">
<head>
<link rel="canonical" href="https://okumuralab.org/~okumura/stat/var_or_varp.html">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>分散はnで割るかn-1で割るか</title>
<link rel="stylesheet" href="style.css">
<link rel="license" href="http://creativecommons.org/licenses/by/4.0/">
<script>
MathJax = {
  chtml: {
    matchFontHeight: false
  },
  tex: {
    inlineMath: [['$', '$']]
  }
};
</script>
<script id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
</script>
</head>
<body>

<nav id="breadcrumbs">
<a href="../">ホーム</a> &gt;
<a href="./">統計・データ解析</a> &gt;
</nav>

<h1>分散は <i lang="en">n</i> で割るか <i lang="en">n</i> − 1 で割るか</h1>

<p>以下は，<em>期待値の意味で</em>どちらが自然かを述べたものです。現実問題では，どちらで割った分散も大差ありません。</p>

<h2>問題</h2>

<p>$n$ 個の数値 $x_1$，$x_2$，...，$x_n$ が与えられたとき，それらの平均値 $\bar{x}$ は</p>

\[ \bar{x} = \frac{x_1 + x_2 + \cdots + x_n}{n} \]

<p>で求められます。また，分散 $s^2$ は，高校の教科書では</p>

\[ s^2 = \frac{1}{n} ((x_1 - \bar{x})^2 + (x_2 - \bar{x})^2 + \cdots + (x_n - \bar{x})^2) \]

<p>で求めることになっていますが，大学に入ると</p>

\[ s^2 = \frac{1}{n-1} ((x_1 - \bar{x})^2 + (x_2 - \bar{x})^2 + \cdots + (x_n - \bar{x})^2) \]

<p>で求めるように言われると思います。以下ではこれらをそれぞれ「$n$ で割る分散」，「$n-1$ で割る分散」と呼んでいます。これらの違いはどこにあるのでしょうか。</p>

<p>Excelでは，$n$ で割る分散を「VAR.P」（新しい流儀）または「VARP」（古い流儀），$n-1$ で割る分散を「VAR.S」（新しい流儀）または「VAR」（古い流儀）という関数で求めます。どうやら「P」は母集団（population），「S」は標本（sample）の意味のようですが，Excelのヘルプを見ても，使い方の区別がよくわかりません。</p>

<p>例えば見滝原中学校2年A組36人のテストの点数の分散を求める場合，36人のテストの点数は母集団でしょうか，標本でしょうか。これら36人だけ考える場合は母集団，もっと大勢の中学2年生を考える場合は標本だという説明がされるようですが，考え方によって答えが違うというのは，よくわかりません。何も言われなければ，どちらを使えばいいのでしょうか。</p>

<h2>$n-1$ で統一しよう</h2>

<p>目の前にいる36人が母集団か標本かで悩むことなく，つねに $n-1$ で割ることをお勧めします（高校の教科書とは違う流儀です）。</p>

<p>なぜかというと，$n-1$ で割る分散は，個数による偏り（バイアス）がないからです。具体的には，次のことが言えます（どちらも期待値の意味で言えることで，いつもこうなるというわけではありません）：</p>

<ul>
  <li>見滝原中学校2年A組とB組は，人数が違う。A・B組への配属はランダムにされたとすると，$n-1$ で割る分散はどちらの組も期待値が等しいが，$n$ で割る分散は，人数が少ない組のほうが小さくなる傾向がある。</li>
  <li>見滝原中学校2年A組のうち何人かがランダムに欠席した。$n-1$ で割る分散は欠席にかかわらず期待値が等しいが，$n$ で割る分散は欠席したほうが小さくなる傾向がある。</li>
</ul>

<h2>理由：Rによる数値実験</h2>

<p>ここでは理由を数学的に説明する代わりに，Rで数値実験をして示すことにします。</p>

<p>Rでは，$n-1$ で割る分散を求める関数は <code>var()</code> ですが，$n$ で割る分散を求める関数はありません（ふつうは使わないからです）。そこで，次のようにして，$n$ で割る分散を求める関数 <code>varp()</code> を作っておきます：</p>

<pre>
<code>&gt; varp = function(x) { var(x) * (length(x)-1) / length(x) }
</code></pre>

<p>5個のデータ $(1,2,3,4,5)$ で試してみましょう：</p>

<pre>
<code>&gt; x = 1:5   # x = c(1,2,3,4,5) と同じ
&gt; var(x)    # n-1 で割る分散
[1] 2.5
&gt; varp(x)   # n で割る分散
[1] 2
</code></pre>

<p>このように少数（上の例では5個）のデータの場合には，$n$ で割るか $n-1$ で割るかでかなりの違いがあります。</p>

<p>この5個のデータ $(1,2,3,4,5)$ から，どれか一つを外した4個のデータを5組作り，それらの分散の平均値を求めて，元の分散と比較してみましょう。まず $n-1$ で割る分散です。</p>

<pre>
<code>&gt; x = 1:5   # x = c(1,2,3,4,5) と同じ
&gt; var(x)    # n-1 で割る分散
[1] 2.5
&gt; var(c(2,3,4,5))  # 1を外す
[1] 1.666667
&gt; var(c(1,3,4,5))  # 2を外す
[1] 2.916667
&gt; var(c(1,2,4,5))  # 3を外す
[1] 3.333333
&gt; var(c(1,2,3,5))  # 4を外す
[1] 2.916667
&gt; var(c(1,2,3,4))  # 5を外す
[1] 1.666667
&gt; mean(c(1.666667,2.916667,3.333333,2.916667,1.666667))  # 一つ外した分散の平均値
[1] 2.5
</code></pre>

<p>このように，一つ外した分散の期待値は，元と同じ2.5になります。同様に，二つ外しても，三つ外しても，期待値は同じです。このような性質を「偏り（バイアス）がない」または「不偏」（unbiased）ということがあります。Excelの説明に「不偏分散」ということばが現れますが，このことを指します。</p>

<p>$n$ で割る分散では，こうなりません：</p>

<pre>
<code>&gt; x = 1:5   # x = c(1,2,3,4,5) と同じ
&gt; varp(x)   # n で割る分散
[1] 2
&gt; varp(c(2,3,4,5))  # 1を外す
[1] 1.25
&gt; varp(c(1,3,4,5))  # 2を外す
[1] 2.1875
&gt; varp(c(1,2,4,5))  # 3を外す
[1] 2.5
&gt; varp(c(1,2,3,5))  # 4を外す
[1] 2.1875
&gt; varp(c(1,2,3,4))  # 5を外す
[1] 1.25
&gt; mean(c(1.25,2.1875,2.5,2.1875,1.25))
[1] 1.875
</code></pre>

<p>つまり，一つ外したほうが分散が（期待値として）小さくなる傾向があります。</p>

<hr>

<p><a href="../" rel="author">奥村 晴彦</a></p>

<p>
<!-- hhmts start -->
Last modified: <time>2016-06-03 12:59:38</time>
<!-- hhmts end -->
</p>
</body>
</html>
