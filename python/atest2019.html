<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<title>全国学力テストの都道府県別正答率（2019年版）</title>
<link rel="stylesheet" href="style.css">
<link rel="license" href="http://creativecommons.org/licenses/by/4.0/">
</head>
<body>

<nav id="breadcrumbs">
<a href="/~okumura/">ホーム</a> &gt;
<a href="./">Python</a> &gt;
</nav>

<h1>全国学力テストの都道府県別平均正答率（2019年版）</h1>

<p>2019年7月31日に，平成31年度全国学力テスト（正確には「全国学力・学習状況調査」）の結果が国研の<a href="http://www.nier.go.jp/kaihatsu/zenkokugakuryoku.html">このページ</a>で公開された。例によって都道府県別平均正答率（％）は丸めて整数にしてある。そこで，都道府県ごとの正答数の度数分布のExcelファイルから精密な正答率を求めてCSV形式にした。</p>

<p>まず，<a href="https://www.nier.go.jp/19chousakekkahoukoku/index.html">報告書・調査結果資料</a>からリンクされているファイル群を全部ダウンロードする（これはPythonではなくUNIXのコマンドである）。実際に全部を使うわけではないので，もっと絞ることも可能であるが，とりあえず：</p>

<pre>
wget --timestamping --recursive --no-parent --wait=1 \
     https://www.nier.go.jp/19chousakekkahoukoku/index.html
</pre>

<p>必要なファイル名のリストを得るには <a href="https://docs.python.org/3/library/pathlib.html">pathlib</a> と正規表現ライブラリ <a href="https://docs.python.org/3/library/re.html">re</a> を使う：</p>

<pre>
import pathlib, re

path = pathlib.Path("www.nier.go.jp/19chousakekkahoukoku/factsheet/19prefecture-City")
names = sorted([p for p in path.glob("**/*.xlsx") if re.search(r"/\d\dp_19r\.xlsx$", str(p))])
</pre>

<p>まず小学校についてExcelファイルを読んで平均正答率を計算する：</p>

<pre>
from openpyxl import load_workbook
import numpy as np

def f(n):
    wb = load_workbook(n, read_only=True)
    ws = wb.worksheets[0]['AE8:AE22']
    n = len(ws)
    x = np.array([ws[i][0].value for i in range(n)])
    koku = (x @ np.arange(n)[::-1]) / np.sum(x) * (100 / (n-1))
    ws = wb.worksheets[1]['AE8:AE22']
    n = len(ws)
    x = np.array([ws[i][0].value for i in range(n)])
    san = (x @ np.arange(n)[::-1]) / np.sum(x) * (100 / (n-1))
    return [koku, san]

sho = np.array([f(n) for n in names])
</pre>

<p>同様に中学校も：</p>

<pre>
names = sorted([p for p in path.glob("**/*.xlsx") if re.search(r"/\d\dm_19r\.xlsx$", str(p))])

def f(n):
    wb = load_workbook(n, read_only=True)
    ws = wb.worksheets[0]['AE8:AE18']
    n = len(ws)
    x = np.array([ws[i][0].value for i in range(n)])
    koku = (x @ np.arange(n)[::-1]) / np.sum(x) * (100 / (n-1))
    ws = wb.worksheets[1]['AE8:AE24']
    n = len(ws)
    x = np.array([ws[i][0].value for i in range(n)])
    suu = (x @ np.arange(n)[::-1]) / np.sum(x) * (100 / (n-1))
    ws = wb.worksheets[2]['AE8:AE29']
    n = len(ws)
    x = np.array([ws[i][0].value for i in range(n)])
    ei = (x @ np.arange(n)[::-1]) / np.sum(x) * (100 / (n-1))
    return [koku, suu, ei]

chu = np.array([f(n) for n in names])
</pre>

<p>水平方向に結合する：</p>

<pre>
shochu = np.hstack((sho, chu))
</pre>

<p>CSV形式で保存（Excelや「メモ帳」で文字化けしないようにBOM付きUTF-8，行末CRLF）：</p>

<pre>
import pandas as pd

pd.DataFrame(shochu).to_csv("atest2019.csv", index=False,
                            encoding="utf_8_sig", line_terminator="\r\n",
                            header=["小国","小算","中国","中数","中英"])
</pre>

<p>結果は <a href="data/atest2019.csv">atest2019.csv</a> として置いておく。</p>

<p>都道府県名は特に付けていない。必要なら次のリストを使う：</p>

<pre>
kenmei = ["北海道", "青森県", "岩手県", "宮城県", "秋田県", "山形県",
  "福島県", "茨城県", "栃木県", "群馬県", "埼玉県", "千葉県", "東京都",
  "神奈川県", "新潟県", "富山県", "石川県", "福井県", "山梨県", "長野県",
  "岐阜県", "静岡県", "愛知県", "三重県", "滋賀県", "京都府", "大阪府",
  "兵庫県", "奈良県", "和歌山県", "鳥取県", "島根県", "岡山県", "広島県",
  "山口県", "徳島県", "香川県", "愛媛県", "高知県", "福岡県", "佐賀県",
  "長崎県", "熊本県", "大分県", "宮崎県", "鹿児島県", "沖縄県"]
</pre>

<p>ついでに，各科目の正答数分布（全国，国・公・私立）をリストの形で挙げておく。それぞれ正答数0問，1問，2問，…の生徒（児童）数を並べたものである：</p>

<pre>
mkokugo = [6341, 15894, 25438, 36646, 50880, 69370, 95185, 127786,
           166953, 203279, 179498]

msuugaku = [8047, 19454, 31928, 40278, 46123, 50376, 53171, 56251,
            59513, 64337, 70933, 79772, 89387, 96414, 95775, 78450,
            37160]

meigo = [823, 1247, 3937, 9029, 16811, 27252, 38040, 48720, 59644,
         70950, 79952, 87227, 89056, 88087, 84676, 77895, 67556,
         54606, 38438, 22741, 9326, 1237]

pkokugo = [12397, 17864, 25613, 33122, 41213, 50515, 61704, 74986,
           90369, 106214, 119035, 128841, 125067, 102322, 51240]
         
psansuu = [2483, 6363, 16106, 27530, 38028, 48859, 61497, 74694,
           91659, 108309, 125896, 139305, 137438, 109090, 53222]
</pre>

<hr>

<p><a href="../" rel="author">奥村 晴彦</a></p>

<p>
<!-- hhmts start -->
Last modified: <time>2019-08-06 21:31:02</time>
<!-- hhmts end -->
</p>
</body>
</html>
