<!DOCTYPE html>
<html lang="ja">
<head>
<link rel="canonical" href="https://okumuralab.org/~okumura/python/postalcode.html">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>郵便番号CSV</title>
<link rel="stylesheet" href="style.css">
<link rel="license" href="https://creativecommons.org/licenses/by/4.0/">
</head>
<body>

<nav id="breadcrumbs">
<a href="../">ホーム</a> &gt;
<a href="./">Python</a> &gt;
</nav>

<h1>郵便番号CSV</h1>

<p>郵便番号データは日本郵便の<a href="https://www.post.japanpost.jp/zipcode/download.html">郵便番号データダウンロード</a>からダウンロードできる。通常は<a href="https://www.post.japanpost.jp/zipcode/dl/kogaki-zip.html">読み仮名データの促音・拗音を小書きで表記するもの(zip形式)</a>にある「全国一括」をクリックして ken_all.zip をダウンロードし，展開して KEN_ALL.CSV を得る。</p>

<p>しかし，このデータは，CSVでありながら，読むのがたいへん難しい形式になっている。これについてはネットでいろいろ論じられている（例：<a href="https://www.dampfkraft.com/posuto.html">Parsing the Infamous Japanese Postal CSV</a>）。</p>

<p>実際に KEN_ALL.CSV を読んでみよう。文字コードはCP932（SJIS）である。最初の3列は整数であるが頭の0を読み飛ばさないように文字列扱いする：</p>

<pre><code>import pandas as pd

df = pd.read_csv('KEN_ALL.CSV', encoding='cp932', header=None,
                 dtype={0:str, 1:str, 2:str})
</code></pre>

<p><a href="https://www.post.japanpost.jp/zipcode/dl/readme.html">説明</a>によれば14番目の列（<code>df[13]</code>）は更新状態（0: 変更なし，1: 変更あり，2: 廃止）である。<code>df[13].value_counts()</code> と打ち込んでみると</p>

<pre><code>0    124484
1        18
</code></pre>

<p>で廃止データは含まれていないようである。</p>

<p>3番目の列（<code>df[2]</code>）が郵便番号である。<code>df[2].value_counts()</code> と打ち込んでみると</p>

<pre><code>4520961    66
4801103    65
4410302    46
7793405    44
0294205    42
           ..
1630409     1
2860033     1
0900037     1
8020092     1
8700243     1
</code></pre>

<p>つまり郵便番号 4520961 は66行もあることになる。中を覗いてみると，</p>

<pre>
23233,"452  ","4520961","ｱｲﾁｹﾝ","ｷﾖｽｼ","ﾊﾙﾋｱｹｶﾞﾜﾗ","愛知県","清須市","春日明河原",0,0,0,1,0,0
23233,"452  ","4520961","ｱｲﾁｹﾝ","ｷﾖｽｼ","ﾊﾙﾋｲﾁﾊﾞﾝﾜﾘ","愛知県","清須市","春日一番割",0,0,0,1,0,0
23233,"452  ","4520961","ｱｲﾁｹﾝ","ｷﾖｽｼ","ﾊﾙﾋｲﾁﾔｼｷ","愛知県","清須市","春日壱屋敷",0,0,0,1,0,0
23233,"452  ","4520961","ｱｲﾁｹﾝ","ｷﾖｽｼ","ﾊﾙﾋｲｯﾎﾟﾝﾏﾂ","愛知県","清須市","春日一本松",0,0,0,1,0,0
23233,"452  ","4520961","ｱｲﾁｹﾝ","ｷﾖｽｼ","ﾊﾙﾋｲﾅﾘ","愛知県","清須市","春日稲荷",0,0,0,1,0,0
23233,"452  ","4520961","ｱｲﾁｹﾝ","ｷﾖｽｼ","ﾊﾙﾋｲﾘﾏｴ","愛知県","清須市","春日杁前",0,0,0,1,0,0
</pre>

<p>のように延々と続く。<code>df[[6,7]][df[2] == '4520961'].value_counts()</code> としてみると</p>

<pre>
6    7  
愛知県  清須市    66
</pre>

<p>となってすべて清須市であり，この場合は 4520961 と入力すれば「愛知県清須市」まで出力すればよいだろう（これら以外にも清須市はある）。</p>

<p>このような「一つの郵便番号で二以上の町域を表す場合」については <code>df[12]</code> が 1 になっていることからもわかる。</p>

<p>では逆に <code>df[12]</code> が 0 になっていれば郵便番号は一意かというと，そうでもなさそうである。<code>df[2][df[12] == 0].value_counts()</code> としてみると</p>

<pre>
6308037    8
6028368    8
6028374    8
7712102    6
6020816    6
          ..
</pre>

<p>という具合である。例えば 6308037 は</p>

<pre>
29201,"630  ","6308037","ﾅﾗｹﾝ","ﾅﾗｼ","ﾅｶﾏﾁ(5115-5149､5171､5183､5186､","奈良県","奈良市","中町（５１１５〜５１４９、５１７１、５１８３、５１８６、",1,0,0,0,0,0
29201,"630  ","6308037","ﾅﾗｹﾝ","ﾅﾗｼ","5192-5196､5198-5212､5227-5229､","奈良県","奈良市","５１９２〜５１９６、５１９８〜５２１２、５２２７〜５２２９、",1,0,0,0,0,0
29201,"630  ","6308037","ﾅﾗｹﾝ","ﾅﾗｼ","5239-5257､5263､5269-5271､5275､","奈良県","奈良市","５２３９〜５２５７、５２６３、５２６９〜５２７１、５２７５、",1,0,0,0,0,0
29201,"630  ","6308037","ﾅﾗｹﾝ","ﾅﾗｼ","5276-4､5276-5､5277-5280､5284-","奈良県","奈良市","５２７６−４、５２７６−５、５２７７〜５２８０、５２８４〜",1,0,0,0,0,0
29201,"630  ","6308037","ﾅﾗｹﾝ","ﾅﾗｼ","5312､5314､5316-5327､5346､5349､","奈良県","奈良市","５３１２、５３１４、５３１６〜５３２７、５３４６、５３４９、",1,0,0,0,0,0
29201,"630  ","6308037","ﾅﾗｹﾝ","ﾅﾗｼ","5351-5352､5355-5362､5364-5424､","奈良県","奈良市","５３５１〜５３５２、５３５５〜５３６２、５３６４〜５４２４、",1,0,0,0,0,0
29201,"630  ","6308037","ﾅﾗｹﾝ","ﾅﾗｼ","5426､5429-5430､5445､5455､5461､","奈良県","奈良市","５４２６、５４２９〜５４３０、５４４５、５４５５、５４６１、",1,0,0,0,0,0
29201,"630  ","6308037","ﾅﾗｹﾝ","ﾅﾗｼ","5463､5470､5472､5475､5482-5529)","奈良県","奈良市","５４６３、５４７０、５４７２、５４７５、５４８２〜５５２９）",1,0,0,0,0,0
</pre>

<p>となっており，カッコ書きが長いので複数行に分けているようである。このような場合は本来は 6308037 は「奈良県奈良市中町」までにして，カッコ書きは別フィールドにするべきであろう。とりあえずは最初に見つかった項目のカッコ以下を外して表示すればよさそうである。</p>

<p>町域名については，<code>df[8].value_counts()</code> すると，</p>

<pre>
以下に掲載がない場合               1874
本町                        310
栄町                        222
新町                        171
幸町                        157
                         ... 
</pre>

<p>のように「以下に記載がない場合」が非常に多いが，これは町域名として表示しないほうがよさそうである。ほかに「○○町一円」「○○村一円」のようなケースもあるが，これらも「一円」は表示しないのがよさそうである。</p>

<p>以上のような点に注意してデータクレンジングしたものが <a href="https://github.com/polm/posuto">posuto</a> というPythonパッケージおよび JSON ファイルで用意されている。</p>

<p>[2021-02-10 追記] <a href="https://kenall.jp">ケンオール</a>という有料サービスができているようだ。</p>

<hr>

<p><a href="../" rel="author">奥村 晴彦</a></p>

<p>
<!-- hhmts start -->
Last modified: <time>2021-02-10 09:05:49</time>
<!-- hhmts end -->
</p>
</body>
</html>
