<!DOCTYPE html>
<html lang="ja">
<head>
<link rel="canonical" href="https://okumuralab.org/~okumura/stat/leaflet.html">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Leaflet</title>
<link rel="stylesheet" href="style.css">
<link rel="license" href="http://creativecommons.org/licenses/by/4.0/">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
  integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
  crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
  integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
  crossorigin=""></script>
<script src="../js/copypre.js"></script>
</head>
<body>

<nav id="breadcrumbs">
<a href="../">ãƒ›ãƒ¼ãƒ </a> &gt;
<a href="./">çµ±è¨ˆãƒ»ãƒ‡ãƒ¼ã‚¿è§£æ</a> &gt;
</nav>

<h1>Leaflet</h1>

<p>ğŸ‡ºğŸ‡¦ <a href="https://leafletjs.com/">Leaflet</a> ã¯ã‚¦ã‚¯ãƒ©ã‚¤ãƒŠç”Ÿã¾ã‚Œã®ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚</p>

<p><em>[2020-11-01]</em> Leaflet 1.7.1 ã«åˆã‚ã›ã¦æ›´æ–°ã—ã¾ã—ãŸã€‚</p>

<h2>Leafletã¨ã¯</h2>

<p><a href="https://leafletjs.com/">Leaflet</a> ã¯åœ°å›³ã‚’æããŸã‚ã®JavaScriptãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚ã„ã‚ã„ã‚ãªåœ°å›³ã‚¿ã‚¤ãƒ«ãŒä½¿ãˆã¾ã™ã€‚æ¬¡ã®ä¾‹ã¯ <a href="https://www.openstreetmap.org/">OpenStreetMap</a> ã§ã™ã€‚</p>

<div id="map" style="width:100%; height:300px"></div>
<script>
"use strict";
const map = L.map('map').setView([34.7468,136.5248], 15);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
}).addTo(map);
L.marker([34.7468,136.5248]).addTo(map)
    .bindPopup('ã“ã“ã«ã„ã¾ã™')
    .openPopup();
</script>

<p>ä¸Šã®ã‚ˆã†ãªåœ°å›³ã‚’ãƒšãƒ¼ã‚¸ã«åŸ‹ã‚è¾¼ã‚€ã«ã¯ï¼Œã¾ãšï¼Œãƒšãƒ¼ã‚¸ã®é ­æ›¸ãï¼ˆheadè¦ç´ ï¼‰ã«æ¬¡ã®ã‚ˆã†ã«æ›¸ã„ã¦ãŠãã¾ã™ï¼š</p>

<pre>
<code>&lt;link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
  integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
  crossorigin=""/&gt;
&lt;script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
  integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
  crossorigin=""&gt;&lt;/script&gt;
</code></pre>

<p>ãã—ã¦ï¼Œåœ°å›³ã‚’å…¥ã‚ŒãŸã„ã¨ã“ã‚ã«æ¬¡ã®ã‚ˆã†ã«æ›¸ãã¾ã™ï¼š</p>

<pre>
<code>&lt;div id="map" style="width:100%; height:300px"&gt;&lt;/div&gt;
&lt;script&gt;
const map = L.map('map').setView([34.7468,136.5248], 15);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&amp;copy; &lt;a href="https://www.openstreetmap.org/copyright"&gt;OpenStreetMap&lt;/a&gt; contributors'
}).addTo(map);
L.marker([34.7468,136.5248]).addTo(map)
    .bindPopup('ã“ã“ã«ã„ã¾ã™')
    .openPopup();
&lt;/script&gt;
</code></pre>

<p>ã“ã“ã§ <code>[34.7468,136.5248]</code> ã¯ç·¯åº¦ãƒ»çµŒåº¦ã§ã™ã€‚<code>15</code> ã¯å¤§ããªæ•°ã«ã™ã‚‹ã»ã©æ‹¡å¤§ã—ãŸåœ°å›³ã«ãªã‚Šã¾ã™ã€‚</p>

<p>åˆ¥ã®ä¾‹ã¨ã—ã¦<a href="https://cyberjapandata.gsi.go.jp">åœ°ç†é™¢åœ°å›³</a>ã‚’ä½¿ã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</p>

<div id="map2" style="width:100%; height:300px"></div>
<script>
const map2 = L.map('map2').setView([34.7468,136.5248], 15);
L.tileLayer('https://cyberjapandata.gsi.go.jp/xyz/std/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://maps.gsi.go.jp/development/ichiran.html">å›½åœŸåœ°ç†é™¢</a>'
}).addTo(map2);
L.marker([34.7468,136.5248]).addTo(map2)
    .bindPopup('ã“ã“ã«ã„ã¾ã™')
    .openPopup();
</script>

<p>ã“ã‚Œã¯æ¬¡ã®ã‚ˆã†ã«æ›¸ãã¾ã—ãŸã€‚</p>

<pre>
<code>&lt;div id="map2" style="width:100%; height:300px"&gt;&lt;/div&gt;
&lt;script&gt;
const map2 = L.map('map2').setView([34.7468,136.5248], 15);
L.tileLayer('https://cyberjapandata.gsi.go.jp/xyz/std/{z}/{x}/{y}.png', {
    attribution: '&amp;copy; &lt;a href="https://maps.gsi.go.jp/development/ichiran.html"&gt;å›½åœŸåœ°ç†é™¢&lt;/a&gt;'
}).addTo(map2);
L.marker([34.7468,136.5248]).addTo(map2)
    .bindPopup('ã“ã“ã«ã„ã¾ã™')
    .openPopup();
&lt;/script&gt;
</code></pre>

<p>åœ°ç†é™¢åœ°å›³ã«ã¯ã„ã‚ã„ã‚ãªç¨®é¡ãŒã‚ã‚Šã¾ã™ã€‚è©³ã—ãã¯<a href="https://maps.gsi.go.jp/development/ichiran.html">åœ°ç†é™¢ã‚¿ã‚¤ãƒ«ä¸€è¦§</a>ã‚’ã”è¦§ãã ã•ã„ã€‚</p>

<p>Leafletã§Google Mapã‚’ä½¿ã†ã“ã¨ã‚‚ã§ãã¾ã™ï¼ˆã‚°ã‚°ã£ã¦ãã ã•ã„ï¼‰ã€‚</p>

<h2>Rã§Leafletã‚’ä½¿ã†</h2>

<p>Rã® <a href="https://cran.r-project.org/package=leaflet">leaflet</a> ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ãˆã°Rã‹ã‚‰ä¸Šã®ã‚ˆã†ãªåœ°å›³ã‚’ç°¡å˜ã«æ›¸ã‘ã¾ã™ã€‚</p>

<p>ã¾ãšï¼ŒCRANã‹ã‚‰ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ï¼Œèª­ã¿è¾¼ã¿ã¾ã™ï¼š</p>

<pre>
<code>install.packages("leaflet")
library(leaflet)
</code></pre>

<p>ä¸Šã¨åŒæ§˜ã®åœ°å›³ã‚’æãã«ã¯ï¼ŒRã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«æ¬¡ã®ã‚ˆã†ã«æ‰“ã¡è¾¼ã¿ã¾ã™ï¼š</p>

<pre>
<code>m = leaflet()
m = addTiles(m)
m = addMarkers(m, lat=34.7468, lng=136.5248, popup="ã“ã“ã«ã„ã¾ã™")
m
</code></pre>

<p>åœ°ç†é™¢åœ°å›³ã«ã™ã‚‹ã«ã¯2è¡Œç›®ã‚’æ¬¡ã®ã‚ˆã†ã«ã—ã¾ã™ã€‚</p>

<pre>
<code>m = addTiles(m, "//cyberjapandata.gsi.go.jp/xyz/std/{z}/{x}/{y}.png")
</code></pre>

<p>åŒã˜ã“ã¨ã§ã™ãŒï¼Œæ¬¡ã®ã‚ˆã†ãªãƒ‘ã‚¤ãƒ—è¨˜æ³•ã‚‚ä½¿ãˆã¾ã™ï¼š</p>

<pre>
<code>m = leaflet() %>%
  addTiles() %>%
  addMarkers(lat=34.7468, lng=136.5248, popup="ã“ã“ã«ã„ã¾ã™")
m
</code></pre>

<p>ã•ã‚‰ã«è©³ã—ã„èª¬æ˜ãŒ <a href="https://rstudio.github.io/leaflet/">ã“ã¡ã‚‰</a> ã«ã‚ã‚Šã¾ã™ã€‚</p>

<h2>leafletã§æ”¾å°„ç·šåœ°å›³</h2>

<p>ã‚‚ã†å¤ã„è©±ã«ãªã‚Šã¾ã—ãŸãŒï¼Œç¦å³¶ã®42ä¸‡ç‚¹ã§ã®æ”¾å°„ç·šæ¸¬å®šã®çµæœã‚’åœ°å›³ã«ã™ã‚‹è©±ãŒ<a href="rgooglemaps.html">RgoogleMapsã‚’ä½¿ã£ãŸæ”¾å°„ç·šåœ°å›³</a>ã«ã‚ã‚Šã¾ã™ã€‚leafletã§42ä¸‡ç‚¹ã«è€ãˆã‚‰ã‚Œã‚‹ã‹ã©ã†ã‹ï¼Œã‚„ã£ã¦ã¿ã¾ã—ãŸã€‚ã‹ãªã‚Šé‡ã„ã®ã§ã”æ³¨æ„ãã ã•ã„ã€‚<a href="https://maps.gsi.go.jp/development/ichiran.html">åœ°ç†é™¢ã‚¿ã‚¤ãƒ«</a>ã®æ·¡è‰²åœ°å›³ã‚’ä½¿ã„ã¾ã—ãŸã€‚ãƒãƒ¼ã‚«ãƒ¼ã®è‰²é£ã„ã«ã‚‚ã£ã¨å·¥å¤«ãŒå¿…è¦ã§ã™ã€‚</p>

<pre>
<code>library(leaflet)
library(RColorBrewer)

cols=c("white",brewer.pal(9, "YlOrRd"),rep("black",100))
fukushima = read.csv("https://okumuralab.org/~okumura/stat/data/fukushima.csv", as.is=TRUE)
t = as.POSIXct(fukushima$datetime)
o = order(t)

m = leaflet(fukushima[o,])
m = addTiles(m, "https://cyberjapandata.gsi.go.jp/xyz/pale/{z}/{x}/{y}.png") # æ·¡è‰²åœ°å›³
m = setView(m, 140.2, 37.38, 9)
m = addCircles(m, radius=10, color=cols[floor(fukushima[o,]$radiation*2)+1])
m = addMarkers(m, lat=37.422778, lng=141.032339, popup="ç¦å³¶ç¬¬ä¸€åŸç™º")
m
</code></pre>

<figure><img src="img/fukushima-leaflet.png" alt="ç¦å³¶çœŒã®æ”¾å°„ç·šåœ°å›³"></figure>

<hr>

<footer>
<p><a href="../" rel="author">å¥¥æ‘ æ™´å½¦</a></p>
<p>
<!-- hhmts start -->
Last modified: <time>2022-04-04 16:26:16 JST</time>
<!-- hhmts end -->
</p>
</footer>
</body>
</html>
