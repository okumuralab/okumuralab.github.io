<!DOCTYPE html>
<html lang="ja">
<head>
<link rel="canonical" href="https://okumuralab.org/~okumura/python/numba.html">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Numba</title>
<link rel="stylesheet" href="style.css">
<link rel="license" href="https://creativecommons.org/licenses/by/4.0/">
</head>
<body>

<nav id="breadcrumbs">
<a href="../">ホーム</a> &gt;
<a href="./">Python</a> &gt;
</nav>

<h1>Numba</h1>

<p><a href="https://numba.pydata.org">Numba</a>（ナンバ）はPythonのJIT（Just In Time）コンパイラです。簡単にいえば，Pythonの自前の関数を高速にする仕組みです。以下は M1 Mac mini 上の Python 3.11.4、NumPy 1.24.3、Numba 0.57.0 で実行しました。</p>

<p>速さ比べのため，まずは100万個の乱数を用意します：</p>

<pre>
import numpy as np

rng = np.random.default_rng(12345)
a = rng.random(1000000)
</pre>

<p>これをPython標準の <code>sum()</code> 関数を使って合計するのに要する時間を計測します：</p>

<pre>
%timeit sum(a)
</pre>

<p>結果：</p>

<pre>
37.6 ms ± 1.13 ms per loop (mean ± std. dev. of 7 runs, 10 loops each)
</pre>

<p>次は，自前の関数を作って，時間を計測します：</p>

<pre>
def sum1(a):
    s = 0
    for x in a:
        s += x
    return s

%timeit sum1(a)
</pre>

<p>結果：</p>

<pre>
45.1 ms ± 894 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)
</pre>

<p>次はNumbaを使ってみましょう。<code>pip install numba</code> などとしてインストールしてから，次を実行します：</p>

<pre>
from numba import jit

@jit(nopython=True)
def sum2(a):
    s = 0
    for x in a:
        s += x
    return s

%timeit sum2(a)
</pre>

<p>結果：</p>

<pre>
941 µs ± 3.73 µs per loop (mean ± std. dev. of 7 runs, 1 loop each)
</pre>

<p>約1ミリ秒です。数十倍速くなりました。最後にNumPyの <code>np.sum()</code> も試します：</p>

<pre>
%timeit np.sum(a)
</pre>

<p>結果：</p>

<pre>
196 µs ± 448 ns per loop (mean ± std. dev. of 7 runs, 1,000 loops each)
</pre>

<p>Numbaで高速化したものよりさらに高速です。</p>

<p>つまり，ループを含むようなPythonのコードはたいていNumbaで高速化できますが，同じ機能のNumPy関数があるなら，そちらを使いましょう。</p>

<p>参考：</p>

<ul>
  <li>Magomed Aliev: 6 ways to significantly speed up Pandas with a couple lines of code. <a href="https://medium.com/swlh/6-ways-to-significantly-speed-up-pandas-with-a-couple-lines-of-code-part-1-2c2dfb0de230">Part 1</a> / <a href="https://medium.com/swlh/6-ways-to-significantly-speed-up-pandas-with-a-couple-lines-of-code-part-2-7a9e41ba76dc">Part 2</a></li>
</ul>

<hr>

<footer>
<p><a href="../" rel="author">奥村 晴彦</a></p>
<p>Last modified: <time>2023-06-18 14:55:14 JST</time></p>
</footer>
</body>
</html>
