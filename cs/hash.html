<!DOCTYPE html>
<html lang="ja">
<head>
<link rel="canonical" href="https://okumuralab.org/~okumura/cs/hash.html">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ハッシュ関数</title>
<link rel="stylesheet" href="style.css">
<link rel="license" href="https://creativecommons.org/licenses/by/4.0/">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@h_okumura">
<meta name="twitter:title" content="ハッシュ関数">
<meta name="twitter:image" content="https://okumuralab.org/~okumura/cs/img/hash.jpg">
</head>
<body>

<figure class="right">
  <img src="img/hash.jpg" width="128" height="128" alt="perfect potato hash recipe">
</figure>

<nav id="breadcrumbs">
<a href="../">ホーム</a> &gt;
<a href="./">コンピュータと情報</a> &gt;
</nav>

<h1>ハッシュ関数</h1>

<p>料理の「ハッシュ」は食材を細かく刻んで混ぜます。ハッシュタグの「#」は縦横に細かく刻むことをイメージする文字です。同様に、データを切り刻んで混ぜ、一定の長さ（例えば128ビットとか256ビットとか）のデータに変換する関数を、ハッシュ関数といいます。ハッシュ関数の値をハッシュ値または単にハッシュといいます。</p>

<div class="note">
<p>ここで扱うハッシュ関数は、厳密には「暗号学的ハッシュ関数」（cryptographic hash function）と呼ばれるものです。ハッシュ関数には、検索の高速化などの用途もあり、そちらで使われるハッシュ関数は、暗号学的ハッシュ関数である必要はありません。</p>
</div>

<p>具体的なハッシュ関数としては、古くは128ビットのMD5（エムディーファイブ）や160ビットのSHA-1（シャーワン）がよく使われました。MD5はもはや暗号学的ハッシュ関数としては使ってはいけません。アメリカのNIST（国立標準技術研究所）は<a href="https://www.nist.gov/news-events/news/2022/12/nist-retires-sha-1-cryptographic-algorithm">SHA-1を2030年に終了する</a>と発表しました。今後はSHA-2およびSHA-3と呼ばれる方法を使うべきです。SHA-2にはビット数の異なるいくつかのバリエーションがあり、256ビットのSHA-256（シャー256）などがよく使われます。SHA-3にもいくつかのバリエーションがあります。</p>

<ul>
  <li><a href="../misc/220629.html">ハッシュ関数</a>（コマンドで求める方法）</li>
  <li><a href="../python/hash.html">ハッシュ関数</a>（Pythonで求める方法）</li>
</ul>

<p>ハッシュは至るところで使われています。例えばビットコインなどで使われているブロックチェーンは、情報のブロックをハッシュでつなぐことにより、改ざんしにくいようになっています。改ざんするには、それとつながったブロックのハッシュを全部再計算しなければなりません。ところがブロックをつなぐハッシュは大量の計算が必要な仕組みになっているので、簡単には改ざんできません。大量の計算をする見返りとして、新たなビットコインが貰えるので、世界中で大量のハッシュの計算が行われています。<a href="https://www.blockchain.com/en/charts/hash-rate">ブロックチェーンの全ハッシュレートのグラフ</a>を見れば、現在だいたい 200 million TH/s (terahashes per second) 程度、つまり 200 エクサハッシュ/秒（エクサは 10<sup>18</sup>）程度の計算が行われています。世界最高速のスーパーコンピュータでも毎秒 1 エクサ回程度の浮動小数点の演算しかできないので、どれだけ大量の計算かがわかると思います。</p>

<p>電力消費量も半端ではありません。<a href="https://ccaf.io/cbeci/index">Bitcoin network power demand</a> というサイトで現在の電力消費量の推定値が公開されています。これも上がり下がりがありますが、2021年の合計は 104.89 TWh（テラワット時）です。比較のため、<a href="https://yearbook.enerdata.jp/electricity/electricity-domestic-consumption-data.html">国内の電力消費量</a>によれば、2021年の日本の年間電力消費量は 916 TWh ですから、日本の 1/9 ほどです。世界の電力消費量は、2019年ですが<a href="https://www.ene100.jp/zumen/1-1-10">エネ百科</a>によれば 25.0 兆 kWh つまり 25000 TWh とのことなので、ビットコインによる消費は 0.42% ほどです。しかもビットコイン以外の暗号資産もあります。</p>

<p>ただ、ブロックチェーンでも、ビットコインのような PoW（Proof of Work）型以外にもいろいろな方式が考えられます。暗号資産第2位のイーサリアムは、2022-09-15 に PoW から PoS（Proof of Stake）への切り替えを伴う <a href="https://ethereum.org/en/upgrades/merge/">The Merge</a> を完了しました。これで電力消費量が 99.95% 減になるはずだとのことです。</p>

<hr>

<footer>
<p><a href="../" rel="author">奥村 晴彦</a></p>
<p>Last modified: <time>2022-12-17 10:08:09 JST</time><br>
Top picture generated by <a href="https://openai.com/dall-e-2/">DALL·E 2</a> with prompt "perfect potato hash recipe"</p>
</footer>
</body>
</html>
