<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Plotly</title>
<link rel="stylesheet" href="style.css">
<link rel="license" href="https://creativecommons.org/licenses/by/4.0/">
<script>
window.onload = function() {
  let url = /^(.*\/).*\//.exec(location.href)[1];
  let a = document.getElementsByClassName("dirurl");
  [].forEach.call(a, function(x) {x.textContent = url});
}
</script>
<script>window.PlotlyConfig = {MathJaxConfig: 'local'};</script>
<script src="https://cdn.plot.ly/plotly-2.9.0.min.js"></script>
</head>
<body>

<nav id="breadcrumbs">
<a href="../">ãƒ›ãƒ¼ãƒ </a> &gt;
<a href="./">Python</a> &gt;
</nav>

<h1>Plotly</h1>

<h2>ç°¡å˜ãªä¾‹</h2>

<p><a href="https://plotly.com/graphing-libraries/">Plotly</a> ã¯å¯¾è©±å‹è¦–è¦šåŒ–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã‚ã‚‹ã€‚ä¸­èº«ã¯JavaScriptã ãŒPythonã‚„Rãªã©ã§æ“ä½œã§ãã‚‹ã€‚</p>

<p>ã“ã“ã§ã¯ï¼Œç§ã®<a href="220217.html">å¹³å‡èº«é•·ã®æ¨ç§»</a>ã®ãƒ‡ãƒ¼ã‚¿ã‚’imabari_ehimeã•ã‚“ãŒPlotlyã§ã‚°ãƒ©ãƒ•åŒ–ã•ã‚ŒãŸ<a href="https://imabari.hateblo.jp/entry/2022/02/17/221849">å¹³å‡èº«é•·ã®æ¨ç§»ã‚’plotlyã§ã‚°ãƒ©ãƒ•åŒ–</a>ã¨ã„ã†è¨˜äº‹ã‚’å‚è€ƒã«ã—ã¦ï¼ŒPlotlyã‚’è§¦ã£ã¦ã¿ã‚ˆã†ã€‚</p>

<p>ã¾ãšã¯ <code>pip install plotly</code> ãªã©ã¨ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚</p>

<pre class="cell">
import pandas as pd

pd.options.plotting.backend = "plotly"

df = pd.read_csv("<span class="dirurl">https://okumuralab.org/~okumura/</span>python/data/height.csv",
                 index_col=0)

fig = df[["ç”·17æ­³", "ç”·16æ­³", "ç”·15æ­³"]].plot(markers=True)
</pre>

<p>ã“ã“ã¾ã§ã§ã¯ä½•ã‚‚èµ·ã“ã‚‰ãªã„ã€‚ã“ã“ã§</p>

<pre class="cell">
fig.show()
</pre>

<p>ã¨æ‰“ã¡è¾¼ã‚€ã¨ï¼Œhttp://127.0.0.1:53999 ã®ã‚ˆã†ãªã‚¢ãƒ‰ãƒ¬ã‚¹ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®Webãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ãï¼Œã‚°ãƒ©ãƒ•ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã€‚ãƒã‚¦ã‚¹ã§ç¯„å›²æŒ‡å®šã™ã‚Œã°ï¼Œãã®éƒ¨åˆ†ãŒæ‹¡å¤§è¡¨ç¤ºã•ã‚Œã‚‹ã€‚å›³ã‚’ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ï¼ˆã‚¹ãƒãƒ›ãªã‚‰ãƒ€ãƒ–ãƒ«ã‚¿ãƒƒãƒ—ï¼‰ã™ã‚‹ã‹å³ä¸Šã®ã€ŒğŸ  Reset axesã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã›ã°å…ƒã®ã‚µã‚¤ã‚ºã«æˆ»ã‚‹ã€‚ã€ŒğŸ“· Download plot as a pngã€ã§PNGç”»åƒã¨ã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã‚‹ã€‚ </p>

<p>å¯¾è©±å‹ã®ã¾ã¾ã®å›³ã‚’Webã§å…¬é–‹ã™ã‚‹ã«ã¯ï¼Œã„ãã¤ã‹ã®æ–¹æ³•ãŒã‚ã‚‹ã€‚ã¾ãš</p>

<pre class="cell">
fig.write_html("fig.html")
</pre>

<p>ã§ï¼Œã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ¼ãƒ³ã®å·¨å¤§ãªHTMLãƒ•ã‚¡ã‚¤ãƒ«ãŒã§ãã‚‹ã€‚</p>

<p>åˆ¥ãƒšãƒ¼ã‚¸ã«ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ãƒ‰ã™ã‚‹ãŸã‚ã®è»½ã„å›³ã‚’å‡ºåŠ›ã™ã‚‹ã«ã¯ï¼Œä¾‹ãˆã°</p>

<pre class="cell">
fig.write_html("fig.html", include_plotlyjs=False, full_html=False,
               default_width=800, default_height=600)
</pre>

<p>ã®ã‚ˆã†ã«ã™ã‚‹ï¼ˆ<code>default_width="100%"</code> ã§ãƒ–ãƒ©ã‚¦ã‚¶ã®å¹…ã„ã£ã±ã„ã®å›³ã«ãªã‚‹ï¼‰ã€‚ã“ã‚Œã‚’åˆ¥ãƒšãƒ¼ã‚¸ã«ã‚³ãƒ”ãƒšã™ã‚Œã°ã‚ˆã„ï¼ˆã‚ã‚‹ã„ã¯ä½•ã‚‰ã‹ã®æ–¹æ³•ã§ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ãƒ‰ã™ã‚‹ï¼‰ã€‚åˆ¥ãƒšãƒ¼ã‚¸ã®ãƒ˜ãƒƒãƒ€ã«ã¯æ¬¡ã®2è¡Œã‚’å…¥ã‚Œã¦ãŠãï¼š</p>

<pre>
&lt;script&gt;window.PlotlyConfig = {MathJaxConfig: 'local'};&lt;/script&gt;
&lt;script src="https://cdn.plot.ly/plotly-2.9.0.min.js"&gt;&lt;/script&gt;
</pre>

<p>ã“ã‚Œã‚’å®Ÿéš›ã«è¡Œã†ã¨ï¼Œæ¬¡ã®ã‚ˆã†ã«ãªã‚‹ï¼š</p>

<div id="plotly_ex1" class="plotly-graph-div" style="height:600px; width:800px;"></div>
<script src="js/plotly_ex1.js"></script>

<p>ç¯„å›²æŒ‡å®šã—ãŸã‚Šã—ã¦å¯¾è©±å‹ã«å‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèªã•ã‚ŒãŸã„ã€‚</p>

<h2>Plotly Express</h2>

<p>ä¸Šã¨åŒã˜å›³ã‚’ <a href="https://plotly.com/python/plotly-express/">Plotly Express</a> ã®<a href="https://plotly.com/python/line-charts/">æŠ˜ã‚Œç·šã‚°ãƒ©ãƒ•</a>ã‚’ä½¿ã£ã¦æã„ã¦ã¿ã‚ˆã†ï¼š</p>

<pre class="cell">
import pandas as pd
import plotly.express as px

df = pd.read_csv("https://oku.edu.mie-u.ac.jp/~okumura/python/data/height.csv")
fig = px.line(df, x='å¹´åº¦', y=["ç”·17æ­³", "ç”·16æ­³", "ç”·15æ­³"], markers=True)
fig.write_html("fig.html", include_plotlyjs=False, full_html=False,
               default_width=800, default_height=600)
</pre>

<p>çµæœã¯ä¸Šã¨ã»ã¼åŒã˜ãªã®ã§çœç•¥ã™ã‚‹ã€‚</p>

<p><a href="https://plotly.com/python/bar-charts/">æ£’ã‚°ãƒ©ãƒ•</a>ã®ä¾‹ã¨ã—ã¦ï¼Œæ¯æ—¥ã®æ±äº¬éƒ½ã®COVID-19æ„ŸæŸ“ç¢ºèªè€…æ•°ï¼š</p>

<pre class="cell">
import pandas as pd
import plotly.express as px

df = pd.read_csv("<span class="dirurl">https://okumuralab.org/~okumura/</span>python/data/COVID-tokyo.csv")
fig = px.bar(df.query('date &gt;= "2022-01-01"'), x='date', y='confirmed')
fig.write_html("fig.html", include_plotlyjs=False, full_html=False,
               default_width=800, default_height=600)
</pre>

<div id="plotly_ex2" class="plotly-graph-div" style="height:600px; width:800px;"></div>
<script src="js/plotly_ex2.js"></script>

<p>æ£’ã®å¹…ã‚’ä¸¸ä¸€æ—¥ï¼ˆ86400000ãƒŸãƒªç§’ï¼‰ã«åºƒã’ãŸã„ã¨ãã¯ <code>fig = ...</code> ã®æ¬¡ã« <code>fig.update_traces(width=86400000)</code> ã‚’å…¥ã‚Œã‚‹ã€‚</p>

<h2>å›³ã®JavaScriptéƒ¨åˆ†ã‚’åˆ‡ã‚Šå‡ºã—ã¦åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã«ã™ã‚‹</h2>

<p><code>fig.write_html()</code> ãŒåãå‡ºã™HTMLã¯ <code>&lt;div id="..." class="plotly-graph-div" style="height:600px; width:800px;"&gt;&lt;/div&gt;</code> ã®ã‚ˆã†ãªå›³ã®å…¥ã‚Œå ´æ‰€ä»¥å¤–ã¯JavaScriptã‚³ãƒ¼ãƒ‰ãªã®ã§ï¼Œã“ã‚Œã‚‰ã‚’åˆ†é›¢ã™ã‚Œã°ï¼Œã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ãƒ‰ãŒã‚ˆã‚Šç°¡å˜ã«ã§ãã‚‹ã€‚</p>

<p>å…·ä½“çš„ã«ã¯ï¼Œä¾‹ãˆã°æ¬¡ã®ã‚ˆã†ã«ã™ã‚‹ï¼š</p>

<pre class="cell">
import re

ï¼ˆã‚°ãƒ©ãƒ•ã‚’æãéƒ¨åˆ†ã¯ç•¥ï¼‰

fig.write_html("fig.html", include_plotlyjs=False, full_html=False,
               default_width=800, default_height=600, div_id="plotly_ex1")

with open("fig.html") as f:
    text = f.read()
m = re.search('(&lt;div id="(.*?)".*?&lt;/div&gt;) *&lt;script type="text/javascript"&gt; *(.*) *&lt;/script&gt;',
              text)
if m:
    div = m[1]
    id = m[2]
    js = m[3]
    js = re.sub("      *", "\n", js)
    print(div)
    print('&lt;script src="js/' + id +'.js"&gt;&lt;/script&gt;')
    with open(id + ".js", "w") as f:
        f.write(js)
</pre>

<p>æ¨™æº–å‡ºåŠ›ã«å‡ºåŠ›ã•ã‚Œã‚‹2è¡Œã ã‘ã‚’HTMLã«ã‚³ãƒ”ãƒšã—ï¼Œãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦å‡ºåŠ›ã•ã‚Œã‚‹JavaScriptã‚³ãƒ¼ãƒ‰ã‚’ <code>js/</code> ã‚µãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«å…¥ã‚Œã‚‹ã€‚æœ€çµ‚çš„ã«ã“ã®ãƒšãƒ¼ã‚¸ã¯ãã®ã‚ˆã†ã«ã—ã¦ä½œã£ãŸã€‚</p>

<p>ãªãŠï¼Œ<code>style="height:600px; width:800px;"</code> ã®ä»£ã‚ã‚Šã« <code>style="max-width:100%"</code> ã¨ã™ã‚‹ã¨ãƒ–ãƒ©ã‚¦ã‚¶ã®å¹…ã«ãªã‚‹ã€‚<a href="suicide.html">è‡ªæ®ºçµ±è¨ˆ</a>ã®å›³ã¯ãã®ã‚ˆã†ã«ã—ãŸã€‚ã©ã¡ã‚‰ãŒä½¿ã„ã‚„ã™ã„ã§ã‚ã‚ã†ã‹ã€‚</p>

<hr>

<p><a href="../" rel="author">å¥¥æ‘ æ™´å½¦</a></p>

<p>
<!-- hhmts start -->
Last modified: <time>2022-02-28 13:56:25</time>
<!-- hhmts end -->
</p>
</body>
</html>
