<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<title>プロット</title>
<link rel="stylesheet" href="style.css">
<link rel="license" href="http://creativecommons.org/licenses/by/4.0/">
</head>
<body>

<nav id="breadcrumbs">
<a href="/~okumura/">ホーム</a> &gt;
<a href="./">Python 3</a> &gt;
</nav>

<h1>プロット</h1>

<h2>matplotlib</h2>

<p>プロット（グラフ描画）には <a href="https://matplotlib.org/">matplotlib</a> を使います。これは MATLAB ライクなライブラリです。</p>

<p>もし，例えば</p>

<pre>
import matplotlib.pyplot as plt
plt.plot([1,2,3,4], [-2,1,-1,2])
plt.show()
</pre>

<p>と打ち込んで何も出ないようなら，<code>~/.matplotlib/matplotlibrc</code> にバックエンドの名前を指定します。Macなら次のようにすれば動きました：</p>

<pre>
backend: TkAgg
</pre>

<p>デフォルトのフォントは DejaVu Sans という優れものですが，日本語が出ません。日本語を多用するなら，システムにインストールされている適当な TrueType フォント名を指定します。日本語も使うなら，<a href="https://ipafont.ipa.go.jp">こちら</a>から IPAex ゴシックをいただいてきてシステムにインストールし，さきほどの <code>~/.matplotlib/matplotlibrc</code> に次のように書き加えます：</p>

<pre>
font.family: IPAexGothic
</pre>

<p>その際，もし古い <code>~/.matplotlib/font*</code> のようなフォントのキャッシュファイルがあれば消しておきます。Mac なら IPAexGothic 以外に AppleGothic も使えます。</p>

<p><code>font.family</code> のデフォルト値は <code>sans-serif</code> で，DejaVu Sans が使われます。<code>serif</code> と指定すれば DejaVu Serif になります。</p>

<p>PDF で保存する場合，TrueType フォントは Type 3 形式でサブセット埋め込みされます。OpenType の Source Han Sans などは，日本語表示には使えますが，サブセット化できず，丸ごと埋め込まれてしまい，PDF のファイルサイズが巨大になります。</p>

<div class="note">
<p><code>~/.matplotlib/matplotlibrc</code> を作る前の，システムの <code>matplotlibrc</code> の位置は，ターミナルに次のコマンドを打ち込めば表示されます：</p>
<pre>
python -c "import matplotlib; print(matplotlib.matplotlib_fname())"
</pre>
</div>

<p>簡単なプロットで試してみましょう。ターミナルで IPython を使うなら <code>ipython --matplotlib</code> として起動します。Jupyter Notebook の環境なら</p>

<pre>
%matplotlib inline
</pre>

<p>という1行をまず打ち込みます。そして，次のように打ち込みます：</p>

<pre>
import matplotlib.pyplot as plt
plt.plot([1,2,3,4], [-2,1,-1,2])
plt.title('日本語タイトル')
</pre>

<p>これでもしグラフが出ないなら <code>plt.show()</code> と打ち込みます。日本語タイトルも軸のマイナスも化けずに出れば合格です。もし日本語が出てもマイナスが化ける場合は <code>~/.matplotlib/matplotlibrc</code> に次の1行を追加します：</p>

<pre>
axes.unicode_minus: False
</pre>

<p>環境によっては，<code>plt.show()</code> でグラフが出ても，グラフの窓を閉じない限り，次に進めなくなります。この状態を「ブロック」といいます。ブロックしないようにするには <code>plt.show(block=False)</code> のようにオプションを付けます。</p>

<p>IPython では，詳しいヘルプは例えば <code>?plt.plot</code> のように打ち込めば現れます。</p>

<p>プロットのスタイルはいろいろ選べます。例えば</p>

<pre>
plt.style.use('ggplot')
</pre>

<p>とすれば R の ggplot のスタイルになります。スタイルは <code>plt.style.available</code> で一覧できます。もっと細かい設定は <code>plt.rcParams</code> と打ち込めば一覧できます。フォントも</p>

<pre>
plt.rcParams['font.family'] = 'IPAexGothic'
plt.rcParams['font.size'] = 12
</pre>

<p>あるいは同じことですが</p>

<pre>
plt.rc('font', 'family'='IPAexGothic', 'size'=12)
</pre>

<p>のようにして変更できます。デフォルト状態に戻すには <code>plt.rcdefaults()</code> と打ちます。</p>

<p>タイトルやラベルに日本語のフォントを使う程度なら，特にデフォルトのフォントを変えなくても，次のように関数にオプションで与えることもできます：</p>

<pre>
plt.title('日本語タイトル', fontfamily='IPAexGothic')
plt.xlabel('日本語のx軸タイトル', fontfamily='IPAexGothic')
</pre>

<h2>seaborn</h2>

<p>R では ggplot2 というライブラリが人気ですが，Python では <a href="https://seaborn.pydata.org/">seaborn</a> というデータ視覚化ライブラリが人気です。<code>conda install seaborn</code> などとしてインストールしておきましょう。seaborn は matplotlib の上で動いているので，いずれにしても matplotlib の設定は必要です。seaborn については Kaggle で <a href="https://www.kaggle.com/learn/data-visualization-from-non-coder-to-coder">Data Visualization: from Non-Coder to Coder</a> という初心者向けの無料講座があるようです。</p>

<p>下は seaborn の簡単な例です：</p>

<pre>
import seaborn as sns
iris = sns.load_dataset("iris")
sns.pairplot(iris)
</pre>

<figure><img src="img/seaborn_iris.png" alt="Iris"></figure>

<p>スタイルの設定やフォントの設定は次のようにします：</p>

<pre>
sns.set_style("darkgrid", {'font.family': ['IPAexGothic']})
</pre>

<h2>ファイルへの保存</h2>

<p>ファイルへの保存は，メニューからも，プログラムでもできます：</p>

<pre>
plt.savefig('filename.png', dpi=80, bbox_inches="tight")
plt.savefig('filename.pdf', bbox_inches="tight")
plt.savefig('filename.pgf', bbox_inches="tight")
</pre>

<p>最後のPGF（Portable Graphics Format）はTeXのTi<i>k</i>Zのベースとなるグラフィック言語です。これは次のような形のLaTeXファイルを <code>xelatex</code> か <code>lualatex</code> でコンパイルすることによってPDFに変換できます：</p>

<pre>
\documentclass{standalone}
\usepackage{pgf}
\usepackage{fontspec}
\begin{document}
\input{filename.pgf}
\end{document}
</pre>

<h2>LaTeXを使う</h2>

<p>軸の文字やタイトル・キャプションなどをLaTeX経由で出力することができます。</p>

<pre>
import matplotlib.pyplot as plt
import numpy as np

plt.rcParams['text.usetex'] = True
plt.rcParams['text.latex.preamble'] = r'\usepackage{tgtermes},\usepackage{newtxmath}'  # プリアンブルの設定例

x = np.linspace(-5,5,101)
y = 1 / (1 + np.exp(-x))
plt.figure(figsize=(5, 3))
plt.plot(x, y, 'k')
plt.xlabel(r'$x$')
plt.ylabel(r'$y$')
plt.title("sigmoid function")
plt.legend([r'$y = \frac{1}{1+e^{-x}}$'])
plt.savefig("sigmoid.pdf", bbox_inches="tight")
</pre>

<p><code>~/.matplotlib/tex.cache</code> にLaTeXファイルやdviファイルがたくさんできます。</p>

<p>LaTeXのコマンドを含む文字列を <code>r'...'</code> のように書くのは，<code>\</code> を特別扱いしない「生の」（raw）文字列にするためです。</p>

<hr>

<p><a href="../" rel="author">奥村 晴彦</a></p>

<p>
<!-- hhmts start -->
Last modified: <time>2019-05-04 20:26:13</time>
<!-- hhmts end -->
</p>
</body>
</html>
